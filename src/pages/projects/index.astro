---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

const projects = await getCollection('projects', ({ data }) => !data.draft);
const sortedProjects = projects.sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());
---

<BaseLayout title="Featured Projects" description="Explore CALDONâ„¢'s portfolio of developments across NSW.">
  <style>
    .page-header { padding: 180px 0 100px; text-align: center; background-color: var(--subtle-accent); }
    .page-header .section-subtitle { font-size: 0.75rem; letter-spacing: 3px; text-transform: uppercase; margin-bottom: 15px; color: var(--text-secondary); }
    .page-header h1 { font-family: 'Cormorant Garamond', serif; font-size: 3rem; font-weight: 300; margin-bottom: 20px; }
    .page-header p { font-size: 1rem; color: var(--text-secondary); max-width: 600px; margin: 0 auto; }
    
    .filter-bar { padding: 30px 0; border-bottom: 1px solid var(--border); background: var(--background); position: sticky; top: 70px; z-index: 100; }
    .filter-container { display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; }
    .filter-btn {
      background: none; border: none; font-family: 'Inter', sans-serif;
      font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1.5px;
      color: var(--text-secondary); cursor: pointer; padding: 8px 16px;
      transition: var(--transition); position: relative;
    }
    .filter-btn::after { content: ''; position: absolute; bottom: 0; left: 50%; width: 0; height: 1px; background: var(--text-primary); transition: var(--transition); transform: translateX(-50%); }
    .filter-btn:hover, .filter-btn.active { color: var(--text-primary); }
    .filter-btn.active::after { width: 100%; }
    
    .projects-section { padding: 80px 0 120px; }
    .projects-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 60px 40px; }
    
    .project-card { text-decoration: none; color: inherit; display: block; }
    .project-image { position: relative; width: 100%; aspect-ratio: 16 / 10; overflow: hidden; background: var(--subtle-accent); margin-bottom: 25px; }
    .project-image img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.8s cubic-bezier(0.165, 0.84, 0.44, 1); }
    .project-card:hover .project-image img { transform: scale(1.05); }
    
    .project-status {
      position: absolute; top: 20px; left: 20px; font-size: 0.65rem; font-weight: 500;
      text-transform: uppercase; letter-spacing: 1.5px; padding: 6px 12px;
      background: var(--background); color: var(--text-primary);
    }
    .project-status.completed { background: var(--text-primary); color: var(--background); }
    .project-status.in-progress { background: #f5f5f5; color: var(--text-secondary); }
    .project-status.da-approved { background: #e8f5e9; color: #2e7d32; }
    
    .project-content { padding: 0 5px; }
    .project-location { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 2px; color: var(--text-secondary); margin-bottom: 8px; }
    .project-title { font-family: 'Cormorant Garamond', serif; font-size: 1.6rem; margin-bottom: 12px; transition: var(--transition); }
    .project-card:hover .project-title { color: var(--text-secondary); }
    .project-meta { display: flex; gap: 25px; font-size: 0.8rem; color: var(--text-secondary); }
    .project-meta span { display: flex; align-items: center; gap: 6px; }
    .project-meta span::before { content: ''; width: 4px; height: 4px; background: var(--border); border-radius: 50%; }
    .project-meta span:first-child::before { display: none; }
    
    .empty-state { text-align: center; padding: 100px 20px; color: var(--text-secondary); grid-column: 1 / -1; }
    .empty-state h3 { font-family: 'Cormorant Garamond', serif; font-size: 1.5rem; margin-bottom: 10px; color: var(--text-primary); }
    
    @media (max-width: 992px) { .projects-grid { gap: 50px 30px; } .page-header h1 { font-size: 2.5rem; } }
    @media (max-width: 768px) {
      .projects-grid { grid-template-columns: 1fr; gap: 50px; }
      .page-header { padding: 150px 0 80px; }
      .page-header h1 { font-size: 2rem; }
      .filter-bar { top: 60px; }
      .filter-container { gap: 15px; }
      .filter-btn { font-size: 0.7rem; padding: 6px 12px; }
    }
    @media (max-width: 576px) { .page-header { padding: 130px 0 60px; } .page-header h1 { font-size: 1.8rem; } .project-title { font-size: 1.4rem; } }
  </style>

  <section class="page-header">
    <div class="container">
      <p class="section-subtitle">Portfolio</p>
      <h1>Featured Projects</h1>
      <p>A curated selection of developments across New South Wales.</p>
    </div>
  </section>

  <div class="filter-bar">
    <div class="container">
      <div class="filter-container">
        <button class="filter-btn active" data-filter="all">All Projects</button>
        <button class="filter-btn" data-filter="completed">Completed</button>
        <button class="filter-btn" data-filter="in-progress">In Progress</button>
        <button class="filter-btn" data-filter="da-approved">DA Approved</button>
        <button class="filter-btn" data-filter="residential">Residential</button>
        <button class="filter-btn" data-filter="commercial">Commercial</button>
      </div>
    </div>
  </div>

  <section class="projects-section">
    <div class="container">
      <div class="projects-grid" id="projectsGrid">
        {sortedProjects.map((project) => (
          <a href={`/projects/${project.slug}`} class="project-card" data-type={project.data.type} data-status={project.data.status}>
            <div class="project-image">
              <img src={project.data.thumbnail} alt={project.data.title} />
              <span class={`project-status ${project.data.status}`}>
                {project.data.status === 'completed' ? 'Completed' : project.data.status === 'in-progress' ? 'In Progress' : 'DA Approved'}
              </span>
            </div>
            <div class="project-content">
              <p class="project-location">{project.data.location}</p>
              <h3 class="project-title">{project.data.title}</h3>
              <div class="project-meta">
                <span>{project.data.units}</span>
                <span>{project.data.year}</span>
              </div>
            </div>
          </a>
        ))}
      </div>
      <div class="empty-state" id="emptyState" style="display: none;">
        <h3>No projects found</h3>
        <p>No projects match the selected filter.</p>
      </div>
    </div>
  </section>

  <script>
    const filterBtns = document.querySelectorAll('.filter-btn');
    const projectCards = document.querySelectorAll('.project-card');
    const emptyState = document.getElementById('emptyState');
    const grid = document.getElementById('projectsGrid');

    filterBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        filterBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const filter = btn.dataset.filter;
        let visible = 0;
        projectCards.forEach(card => {
          const show = filter === 'all' || card.dataset.status === filter || card.dataset.type === filter;
          card.style.display = show ? 'block' : 'none';
          if (show) visible++;
        });
        grid.style.display = visible ? 'grid' : 'none';
        emptyState.style.display = visible ? 'none' : 'block';
      });
    });
  </script>
</BaseLayout>
