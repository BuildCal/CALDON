---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

export async function getStaticPaths() {
  const projects = await getCollection('projects', ({ data }) => !data.draft);
  return projects.map((project) => ({
    params: { slug: project.slug },
    props: { project },
  }));
}

const { project } = Astro.props;
const { Content } = await project.render();
const { data } = project;

const allProjects = await getCollection('projects', ({ data }) => !data.draft);
const otherProjects = allProjects.filter(p => p.slug !== project.slug).slice(0, 2);
---

<BaseLayout title={data.title} description={data.description}>
  <style>
    .project-hero { margin-top: 80px; width: 100%; height: 70vh; min-height: 500px; background: var(--subtle-accent); position: relative; overflow: hidden; }
    .project-hero img { width: 100%; height: 100%; object-fit: cover; }
    .project-hero-overlay { position: absolute; bottom: 0; left: 0; right: 0; padding: 60px 0 40px; background: linear-gradient(transparent, rgba(0,0,0,0.5)); }
    .project-hero-content { color: white; }
    .project-status-badge { display: inline-block; font-size: 0.65rem; font-weight: 500; text-transform: uppercase; letter-spacing: 1.5px; padding: 6px 12px; background: var(--background); color: var(--text-primary); margin-bottom: 15px; }
    .project-status-badge.completed { background: var(--text-primary); color: var(--background); }
    .project-status-badge.in-progress { background: #f5f5f5; color: var(--text-secondary); }
    .project-status-badge.da-approved { background: #e8f5e9; color: #2e7d32; }
    .project-hero-title { font-family: 'Cormorant Garamond', serif; font-size: 3.5rem; font-weight: 300; margin-bottom: 10px; }
    .project-hero-location { font-size: 0.9rem; letter-spacing: 2px; text-transform: uppercase; opacity: 0.9; }
    
    .back-link { display: inline-flex; align-items: center; gap: 8px; text-decoration: none; color: var(--text-secondary); font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 40px; transition: var(--transition); }
    .back-link:hover { color: var(--text-primary); }
    .back-link svg { width: 16px; height: 16px; }
    
    .project-content-section { padding: 80px 0; }
    .project-grid { display: grid; grid-template-columns: 1fr 350px; gap: 80px; }
    
    .project-main h2 { font-family: 'Cormorant Garamond', serif; font-size: 2rem; font-weight: 300; margin-bottom: 25px; }
    .project-main :global(p) { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.9; margin-bottom: 25px; }
    .project-main :global(h2) { font-family: 'Cormorant Garamond', serif; font-size: 1.4rem; font-weight: 400; margin-top: 50px; margin-bottom: 20px; }
    
    .highlights-title { font-family: 'Cormorant Garamond', serif; font-size: 1.4rem; font-weight: 400; margin-top: 50px; margin-bottom: 20px; }
    .highlights-list { list-style: none; margin-bottom: 25px; }
    .highlights-list li { font-size: 0.9rem; color: var(--text-secondary); padding: 8px 0 8px 20px; position: relative; }
    .highlights-list li::before { content: '—'; position: absolute; left: 0; color: var(--border); }
    
    .project-sidebar { position: sticky; top: 120px; height: fit-content; }
    .project-details-card { border: 1px solid var(--border); padding: 40px; }
    .project-details-title { font-family: 'Cormorant Garamond', serif; font-size: 1.3rem; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid var(--border); }
    .project-detail-item { margin-bottom: 25px; }
    .project-detail-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1.5px; color: var(--text-secondary); margin-bottom: 6px; }
    .project-detail-value { font-size: 1rem; }
    .project-cta { margin-top: 40px; padding-top: 30px; border-top: 1px solid var(--border); }
    .project-cta-button { display: block; width: 100%; padding: 14px 20px; background: var(--accent); color: var(--background); text-decoration: none; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1.5px; text-align: center; transition: var(--transition); border: 1px solid var(--accent); }
    .project-cta-button:hover { background: var(--background); color: var(--accent); }
    
    .project-gallery { padding: 0 0 100px; }
    .gallery-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
    .gallery-item { aspect-ratio: 4 / 3; overflow: hidden; background: var(--subtle-accent); }
    .gallery-item img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.6s cubic-bezier(0.165, 0.84, 0.44, 1); }
    .gallery-item:hover img { transform: scale(1.05); }
    .gallery-item.large { grid-column: span 2; grid-row: span 2; }
    
    .related-projects { padding: 80px 0; background: var(--subtle-accent); }
    .related-header { text-align: center; margin-bottom: 50px; }
    .section-subtitle { font-size: 0.75rem; letter-spacing: 3px; text-transform: uppercase; margin-bottom: 15px; color: var(--text-secondary); }
    .related-header h2 { font-family: 'Cormorant Garamond', serif; font-size: 2rem; font-weight: 300; }
    .related-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; }
    .related-card { text-decoration: none; color: inherit; }
    .related-card-image { aspect-ratio: 16 / 10; overflow: hidden; background: var(--background); margin-bottom: 20px; }
    .related-card-image img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.6s cubic-bezier(0.165, 0.84, 0.44, 1); }
    .related-card:hover .related-card-image img { transform: scale(1.05); }
    .related-card-location { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1.5px; color: var(--text-secondary); margin-bottom: 5px; }
    .related-card-title { font-family: 'Cormorant Garamond', serif; font-size: 1.3rem; }
    
    @media (max-width: 992px) {
      .project-grid { grid-template-columns: 1fr; gap: 60px; }
      .project-sidebar { position: static; }
      .gallery-grid { grid-template-columns: repeat(2, 1fr); }
      .gallery-item.large { grid-column: span 2; grid-row: span 1; }
      .related-grid { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 768px) {
      .project-hero { height: 50vh; min-height: 400px; }
      .project-hero-title { font-size: 2.5rem; }
      .gallery-grid { grid-template-columns: 1fr; }
      .gallery-item.large { grid-column: span 1; }
      .related-grid { grid-template-columns: 1fr; gap: 40px; }
    }
    @media (max-width: 576px) {
      .project-hero-title { font-size: 2rem; }
      .project-content-section { padding: 60px 0; }
      .project-details-card { padding: 30px 25px; }
    }
  </style>

  <section class="project-hero">
    <img src={data.heroImage} alt={data.title} />
    <div class="project-hero-overlay">
      <div class="container">
        <div class="project-hero-content">
          <span class={`project-status-badge ${data.status}`}>{data.statusLabel}</span>
          <h1 class="project-hero-title">{data.title}</h1>
          <p class="project-hero-location">{data.location}</p>
        </div>
      </div>
    </div>
  </section>

  <section class="project-content-section">
    <div class="container">
      <a href="/projects" class="back-link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="19" y1="12" x2="5" y2="12"></line>
          <polyline points="12 19 5 12 12 5"></polyline>
        </svg>
        Back to Projects
      </a>
      
      <div class="project-grid">
        <div class="project-main">
          <h2>Project Overview</h2>
          <Content />
          
          {data.highlights && data.highlights.length > 0 && (
            <>
              <h3 class="highlights-title">Development Highlights</h3>
              <ul class="highlights-list">
                {data.highlights.map((h) => <li>{h}</li>)}
              </ul>
            </>
          )}
        </div>
        
        <aside class="project-sidebar">
          <div class="project-details-card">
            <h3 class="project-details-title">Project Details</h3>
            <div class="project-detail-item">
              <p class="project-detail-label">Location</p>
              <p class="project-detail-value">{data.fullAddress}</p>
            </div>
            <div class="project-detail-item">
              <p class="project-detail-label">Type</p>
              <p class="project-detail-value">{data.typeLabel}</p>
            </div>
            <div class="project-detail-item">
              <p class="project-detail-label">Units</p>
              <p class="project-detail-value">{data.units}</p>
            </div>
            <div class="project-detail-item">
              <p class="project-detail-label">Status</p>
              <p class="project-detail-value">{data.statusLabel}</p>
            </div>
            <div class="project-detail-item">
              <p class="project-detail-label">Council</p>
              <p class="project-detail-value">{data.council}</p>
            </div>
            <div class="project-cta">
              <a href="/#contact" class="project-cta-button">Enquire About Similar Projects</a>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </section>

  {data.gallery && data.gallery.length > 0 && (
    <section class="project-gallery">
      <div class="container-wide">
        <div class="gallery-grid">
          {data.gallery.map((item, i) => (
            <div class={`gallery-item ${i === 0 ? 'large' : ''}`}>
              <img src={item.image} alt={`${data.title} - Image ${i + 1}`} />
            </div>
          ))}
        </div>
      </div>
    </section>
  )}

  <section class="related-projects">
    <div class="container">
      <div class="related-header">
        <p class="section-subtitle">Explore More</p>
        <h2>Related Projects</h2>
      </div>
      <div class="related-grid">
        {otherProjects.map((p) => (
          <a href={`/projects/${p.slug}`} class="related-card">
            <div class="related-card-image">
              <img src={p.data.thumbnail} alt={p.data.title} />
            </div>
            <p class="related-card-location">{p.data.location}</p>
            <h3 class="related-card-title">{p.data.title}</h3>
          </a>
        ))}
        <a href="/projects" class="related-card">
          <div class="related-card-image" style="display: flex; align-items: center; justify-content: center; background: var(--subtle-accent);">
            <span style="font-size: 0.8rem; text-transform: uppercase; letter-spacing: 2px; color: var(--text-secondary);">View All →</span>
          </div>
          <p class="related-card-location">Portfolio</p>
          <h3 class="related-card-title">All Projects</h3>
        </a>
      </div>
    </div>
  </section>
</BaseLayout>
